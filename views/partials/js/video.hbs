<script>
    $(() => {
        const supportsVideo = !!document.createElement("video").canPlayType;
        if (!supportsVideo) return;

        const video = $("video").get(0);

        // Fade controls
        let timeoutFade;

        $("body").on("mousemove", function () {
            clearTimeout(timeoutFade);
            $(".controls").css("opacity", "1");
            fadeOutControls();
        });

        function fadeOutControls() {
            timeoutFade = setTimeout(function () {
                $(".controls").css("opacity", "0");
            }, 3000);
        }

        // Progress bar
        $("video").on("loadedmetadata", () => {
            $("#video-progress").attr("max", video.duration);
        });

        $("video").on("timeupdate", () => {
            const progress = $("#video-progress").get(0);

            if (!progress.max) progress.max = video.duration;
            progress.value = video.currentTime;

            const percent = (progress.value - progress.min) / (progress.max - progress.min) * 100;
            $("#video-progress").css("background",
            `linear-gradient(to right, red 0%, red ${percent}%, rgba(255, 255, 255, 0.5) ${percent}%, rgba(255, 255, 255, 0.5) 100%)`);
        });

        $("#video-progress").on("input", function() {
            video.currentTime = $(this).val();
            $("video").trigger("timeupdate");
        });

        // Play and Pause
        $("#play-pause").on("click", function () {
            if (video.paused) {
                video.play();
            }
            else {
                video.pause();
            }
            $(this).toggleClass("fa-play fa-pause");
        });

        $("video").on("play", function () {
            $("#play-pause").addClass("fa-pause").removeClass("fa-play");
        });

        $("video").on("pause", function () {
            $("#play-pause").addClass("fa-play").removeClass("fa-pause");
        });

        // Audio
        let muted = false, savedVolume = 1;

        $("#audio").on("click", function() {
            if (muted) {
                video.volume = savedVolume;
                $(this).removeClass("fa-volume-xmark");
                if (savedVolume > 0.5) $(this).addClass("fa-volume-high");
                else $(this).addClass("fa-volume-low");
            }
            else {
                video.volume = 0;
                $(this).removeClass("fa-volume-high fa-volume-low").addClass("fa-volume-xmark");
            }
            muted = !muted;
            $("#audio-range").val(video.volume * 100);
            changeAudioRange();
        });

        $("#audio-range").on("input", function() {
            const inputRange = $("#audio-range").get(0);

            savedVolume = inputRange.value / 100;
            video.volume = savedVolume;

            if (video.volume === 0) {
                muted = true;
                $("#audio").removeClass("fa-volume-high fa-volume-low").addClass("fa-volume-xmark");
            }
            else {
                muted = false;
                if (video.volume < 0.6) $("#audio").removeClass("fa-volume-high fa-volume-xmark").addClass("fa-volume-low");
                else $("#audio").removeClass("fa-volume-low fa-volume-xmark").addClass("fa-volume-high");
            }

            changeAudioRange();
        });

        function changeAudioRange() {
            const inputRange = $("#audio-range").get(0);
            const progress = (inputRange.value - inputRange.min) / (inputRange.max - inputRange.min) * 100;
            $("#audio-range").css("background",
            `linear-gradient(to right, white 0%, white ${progress}%, rgba(255, 255, 255, 0.5) ${progress}%, rgba(255, 255, 255, 0.5) 100%)`);
        }
    });
</script>