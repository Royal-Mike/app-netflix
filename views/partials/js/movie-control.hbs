<script>
    $(document).ready(function () {
        const video = $('#video')[0];

        let src = '', title = '', runtime = '', genres = '', overview = '';
        $('video').prop('volume', '0.1').prop('muted', true);

        $('.movie-hoverred').each(function () {
            $(this).on('mouseover', function () {
                $('.movie-actions', this).removeClass('d-none');
                $('.thumbnail', this).addClass('d-none');

                $('.run-video-when-hovering', this).removeClass('d-none');

                src = $('.thumbnail', this).attr('src');
                title = $('.thumbnail', this).attr('data-title');
                overview = $('.thumbnail', this).attr('data-overview');

                if (title) title = title.toUpperCase();
                runtime = $('.movie-runtime', this).text();

                genres = '';
                $('.all-genre', this).each(function () {
                    const genre = $(this).text().trim();
                    genres = genres + genre + ", ";
                });

                if (genres) {
                    genres = genres.slice(0, genres.length - 2);
                }

                const video = $('.run-video-when-hovering > video', this)[0];
                const checkAvailability = video.play();
                if (checkAvailability !== undefined) {
                    checkAvailability.then(() => {
                    }).catch(error => {
                        video.muted = true;
                        video.play();
                    });
                }

                $(this).css({
                    'transform': 'scale(1.5)',
                    'transition': '0.5s',
                    'position': 'relative',
                });
            });

            $(this).on('mouseleave', function () {
                $('.movie-actions', this).addClass('d-none');
                $('.thumbnail', this).removeClass('d-none');
                $('.run-video-when-hovering', this).addClass('d-none');
                $('.run-video-when-hovering > video', this)[0].pause();
                $('.run-video-when-hovering > video', this)[0].currentTime = 0;
                $(this).css({
                    'transform': 'scale(1)',
                    'transition': '0.5s',
                });
            });
        });

        $('.open-movie-details').on('click', function () {
            {{#unless search}} if (!video.muted) $('.volumn').trigger('click'); {{/unless}}

            const position = window.scrollY;
            const poster_template = `{{> poster}}`;

            $('body').addClass('noscroll');

            $('.outer-container').append(poster_template);
            $('.all-movies').css({
                'pointer-events': 'none',
            });
            $('.all-movies').addClass('unscrollable');

            genres = '';
            $('.overlay-left, .overlay-right').removeClass('invisible');

            setTimeout(() => {
                $('#play-video-in-poster').addClass('d-none');
                $('#poster-video')[0].play();
                $('#poster-video').prop('volume', '0.1');
                $('#video-in-poster').removeClass('d-none');
            }, 1000);

            const posterVideo = $('#poster-video')[0];

            $('.poster-container .turn-on-volumn').on('click', function () {
                posterVideo.muted = true;
                $(this).addClass('d-none');
                $('.poster-container .turn-off-volumn').removeClass('d-none');
            })

            $('.poster-container .turn-off-volumn').on('click', function () {
                posterVideo.muted = false;
                $(this).addClass('d-none');
                $('.poster-container .turn-on-volumn').removeClass('d-none');
            })
        });

        $('body').on('click', '.cancel-review', function () {
            $('.poster-container').css({
                'animation': 'removePoster 0.5s'
            });

            $('body').removeClass('noscroll');

            $('#video-in-poster').addClass('d-none');
            $('#video-in-poster').currentTime = 0;
            $('#play-video-in-poster', this).removeClass('d-none');

            setTimeout(() => {
                $('.poster-container').remove();
            }, 500)

            $('.all-movies').css({
                'pointer-events': '',
            });
            $('.all-movies').removeClass('unscrollable');
            $('.overlay-left, .overlay-right').addClass('invisible');
        });

        $('body').on('click', '.play-video', function () {
            window.location.href = `/watch?name=${title}`;
        });
    });
</script>